UNION
SELECT m.dispatch_ts,
m.eid,
m.mode_type,
m.location_type,
m.street,
m.xstreet1,
m.xstreet2,
m.x_cord,
m.y_cord,
m.y_snap AS lat,
m.x_snap AS long
FROM internal_data.crash_hist_cad_mv m
WHERE NOT (EXISTS ( SELECT 1
FROM internal_data.crash_hist_cad_ped p1
WHERE p1.eid::text = m.eid::text)) AND NOT (EXISTS ( SELECT 1
FROM internal_data.crash_hist_cad_bike b1
WHERE b1.eid::text = m.eid::text)) AND m.x_cord <> 0::numeric)a
LEFT JOIN internal_data.bpd_crashfatalities ON internal_data.bpd_crashfatalities.eid = a.eid
GROUP BY  CAST(a.dispatch_ts AS DATE)
ORDER BY  CAST(a.dispatch_ts AS DATE) DESC
"})
closeAllConnections()
STR.2.M1 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d1) & month(as.Date(rawSTR.2$rctdate)) == month(d1) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d1) & month(as.Date(rawSTR.2$rctdate)) == month(d1) )])*100, digits = 1)
STR.2.M2 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d2) & month(as.Date(rawSTR.2$rctdate)) == month(d2) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d2) & month(as.Date(rawSTR.2$rctdate)) == month(d2) )])*100, digits = 1)
STR.2.M3 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d3) & month(as.Date(rawSTR.2$rctdate)) == month(d3) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d3) & month(as.Date(rawSTR.2$rctdate)) == month(d3) )])*100, digits = 1)
STR.2.M4 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d4) & month(as.Date(rawSTR.2$rctdate)) == month(d4) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d4) & month(as.Date(rawSTR.2$rctdate)) == month(d4) )])*100, digits = 1)
STR.2.M5 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d5) & month(as.Date(rawSTR.2$rctdate)) == month(d5) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d5) & month(as.Date(rawSTR.2$rctdate)) == month(d5) )])*100, digits = 1)
STR.2.M6 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d6) & month(as.Date(rawSTR.2$rctdate)) == month(d6) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d6) & month(as.Date(rawSTR.2$rctdate)) == month(d6) )])*100, digits = 1)
STR.2.M7 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d7) & month(as.Date(rawSTR.2$rctdate)) == month(d7) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d7) & month(as.Date(rawSTR.2$rctdate)) == month(d7) )])*100, digits = 1)
STR.2.M8 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d8) & month(as.Date(rawSTR.2$rctdate)) == month(d8) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d8) & month(as.Date(rawSTR.2$rctdate)) == month(d8) )])*100, digits = 1)
STR.2.M9 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d9) & month(as.Date(rawSTR.2$rctdate)) == month(d9) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d9) & month(as.Date(rawSTR.2$rctdate)) == month(d9) )])*100, digits = 1)
STR.2.M10 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d10) & month(as.Date(rawSTR.2$rctdate)) == month(d10) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d10) & month(as.Date(rawSTR.2$rctdate)) == month(d10) )])*100, digits = 1)
STR.2.M11 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d11) & month(as.Date(rawSTR.2$rctdate)) == month(d11) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d11) & month(as.Date(rawSTR.2$rctdate)) == month(d11) )])*100, digits = 1)
STR.2.M12 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d12) & month(as.Date(rawSTR.2$rctdate)) == month(d12) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d12) & month(as.Date(rawSTR.2$rctdate)) == month(d12) )])*100, digits = 1)
STR.2.M13 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d13) & month(as.Date(rawSTR.2$rctdate)) == month(d13) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d13) & month(as.Date(rawSTR.2$rctdate)) == month(d13) )])*100, digits = 1)
STR.2.M14 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d14) & month(as.Date(rawSTR.2$rctdate)) == month(d14) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d14) & month(as.Date(rawSTR.2$rctdate)) == month(d14) )])*100, digits = 1)
STR.2.M15 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d15) & month(as.Date(rawSTR.2$rctdate)) == month(d15) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d15) & month(as.Date(rawSTR.2$rctdate)) == month(d15) )])*100, digits = 1)
STR.2.M16 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d16) & month(as.Date(rawSTR.2$rctdate)) == month(d16) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d16) & month(as.Date(rawSTR.2$rctdate)) == month(d16) )])*100, digits = 1)
STR.2.M17 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d17) & month(as.Date(rawSTR.2$rctdate)) == month(d17) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d17) & month(as.Date(rawSTR.2$rctdate)) == month(d17) )])*100, digits = 1)
STR.2.M18 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d18) & month(as.Date(rawSTR.2$rctdate)) == month(d18) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d18) & month(as.Date(rawSTR.2$rctdate)) == month(d18) )])*100, digits = 1)
STR.2.M19 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d19) & month(as.Date(rawSTR.2$rctdate)) == month(d19) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d19) & month(as.Date(rawSTR.2$rctdate)) == month(d19) )])*100, digits = 1)
STR.2.M20 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d20) & month(as.Date(rawSTR.2$rctdate)) == month(d20) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d20) & month(as.Date(rawSTR.2$rctdate)) == month(d20) )])*100, digits = 1)
STR.2.M21 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d21) & month(as.Date(rawSTR.2$rctdate)) == month(d21) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d21) & month(as.Date(rawSTR.2$rctdate)) == month(d21) )])*100, digits = 1)
STR.2.M22 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d22) & month(as.Date(rawSTR.2$rctdate)) == month(d22) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d22) & month(as.Date(rawSTR.2$rctdate)) == month(d22) )])*100, digits = 1)
STR.2.M23 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d23) & month(as.Date(rawSTR.2$rctdate)) == month(d23) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d23) & month(as.Date(rawSTR.2$rctdate)) == month(d23) )])*100, digits = 1)
STR.2.M24 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d24) & month(as.Date(rawSTR.2$rctdate)) == month(d24) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d24) & month(as.Date(rawSTR.2$rctdate)) == month(d24) )])*100, digits = 1)
STR.2.M25 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d25) & month(as.Date(rawSTR.2$rctdate)) == month(d25) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d25) & month(as.Date(rawSTR.2$rctdate)) == month(d25) )])*100, digits = 1)
STR.2.M26 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d26) & month(as.Date(rawSTR.2$rctdate)) == month(d26) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d26) & month(as.Date(rawSTR.2$rctdate)) == month(d26) )])*100, digits = 1)
STR.2.M27 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d27) & month(as.Date(rawSTR.2$rctdate)) == month(d27) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d27) & month(as.Date(rawSTR.2$rctdate)) == month(d27) )])*100, digits = 1)
STR.2.M28 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d28) & month(as.Date(rawSTR.2$rctdate)) == month(d28) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d28) & month(as.Date(rawSTR.2$rctdate)) == month(d28) )])*100, digits = 1)
STR.2.M29 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d29) & month(as.Date(rawSTR.2$rctdate)) == month(d29) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d29) & month(as.Date(rawSTR.2$rctdate)) == month(d29) )])*100, digits = 1)
STR.2.M30 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d30) & month(as.Date(rawSTR.2$rctdate)) == month(d30) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d30) & month(as.Date(rawSTR.2$rctdate)) == month(d30) )])*100, digits = 1)
STR.2.M31 <- round(sum(rawSTR.2$fatal_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d31) & month(as.Date(rawSTR.2$rctdate)) == month(d31) )])/sum(rawSTR.2$total_collisions_tdy[which(year(as.Date(rawSTR.2$rctdate)) == year(d31) & month(as.Date(rawSTR.2$rctdate)) == month(d31) )])*100, digits = 1)
STR.2 <- data.frame("Cabinet" = "Streets",
"Metric" = "Average Collision Fatality Rate",
"July_2016" = STR.2.M1,
"August" = STR.2.M2,
"September" = STR.2.M3,
"October" = STR.2.M4,
"November" = STR.2.M5,
"December" = STR.2.M6,
"January_2017" = STR.2.M7,
"February" = STR.2.M8,
"March" = STR.2.M9,
"April" = STR.2.M10,
"May" = STR.2.M11,
"June" = STR.2.M12,
"July_2017" = STR.2.M13,
"August" = STR.2.M14,
"September" = STR.2.M15,
"October" = STR.2.M16,
"November" = STR.2.M17,
"December" = STR.2.M18,
"January_2018" = STR.2.M19,
"February" = STR.2.M20,
"March" = STR.2.M21,
"April" = STR.2.M22,
"May" = STR.2.M23,
"June" = STR.2.M24,
"July_2018" = STR.2.M25,
"August" = STR.2.M26,
"September" = STR.2.M27,
"October" = STR.2.M28,
"November" = STR.2.M29,
"December" = STR.2.M30,
"January_2019" = STR.2.M31
)
### DEPARTMENT OF PUBLIC WORKS ###
LAGANdb <- dbConnect(odbc::odbc(), .connection_string = "driver={SQL Server};server=zpcrmbi01;database=LaganPDM;uid=Tableau_prod_readusr; pwd=Tableau_prod_readusr@2015")
rawSTR.5 <- dbGetQuery(LAGANdb, {"SELECT
'CODE ENFORCEMENT ON-TIME %' as metric_name,
MAX(CONVERT(DATE,[CLOSED_DT])) AS RCTDATE,
COUNT(DISTINCT
CASE WHEN [CLOSED_DT] <= [SLA_TARGET_DT]
THEN [CASE_ENQUIRY_ID]
ELSE NULL
END
) as numerator_value,
COUNT(DISTINCT [CASE_ENQUIRY_ID]) AS denominator_value
FROM
[LaganPDM].[dbo].[lgnbo_CASE_ENQUIRY_B00_DENYHS]
WHERE
[QUEUE] = 'PWDx_Code Enforcement'
AND [CASE_STATUS] = 'Closed'
AND [SOURCE] NOT IN ('City Worker App','Employee Generated')
AND [SLA_TARGET_DT] IS NOT NULL
AND CONVERT(DATE,[CLOSED_DT]) < CONVERT(DATE,GETDATE())
GROUP BY CONVERT(DATE,[CLOSED_DT])
ORDER BY CONVERT(DATE,[CLOSED_DT]) DESC
"})
closeAllConnections()
STR.5.M1 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d1) & month(as.Date(rawSTR.5$RCTDATE)) == month(d1) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d1) & month(as.Date(rawSTR.5$RCTDATE)) == month(d1) )])*100, digits = 1)
STR.5.M2 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d2) & month(as.Date(rawSTR.5$RCTDATE)) == month(d2) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d2) & month(as.Date(rawSTR.5$RCTDATE)) == month(d2) )])*100, digits = 1)
STR.5.M3 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d3) & month(as.Date(rawSTR.5$RCTDATE)) == month(d3) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d3) & month(as.Date(rawSTR.5$RCTDATE)) == month(d3) )])*100, digits = 1)
STR.5.M4 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d4) & month(as.Date(rawSTR.5$RCTDATE)) == month(d4) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d4) & month(as.Date(rawSTR.5$RCTDATE)) == month(d4) )])*100, digits = 1)
STR.5.M5 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d5) & month(as.Date(rawSTR.5$RCTDATE)) == month(d5) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d5) & month(as.Date(rawSTR.5$RCTDATE)) == month(d5) )])*100, digits = 1)
STR.5.M6 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d6) & month(as.Date(rawSTR.5$RCTDATE)) == month(d6) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d6) & month(as.Date(rawSTR.5$RCTDATE)) == month(d6) )])*100, digits = 1)
STR.5.M7 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d7) & month(as.Date(rawSTR.5$RCTDATE)) == month(d7) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d7) & month(as.Date(rawSTR.5$RCTDATE)) == month(d7) )])*100, digits = 1)
STR.5.M8 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d8) & month(as.Date(rawSTR.5$RCTDATE)) == month(d8) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d8) & month(as.Date(rawSTR.5$RCTDATE)) == month(d8) )])*100, digits = 1)
STR.5.M9 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d9) & month(as.Date(rawSTR.5$RCTDATE)) == month(d9) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d9) & month(as.Date(rawSTR.5$RCTDATE)) == month(d9) )])*100, digits = 1)
STR.5.M10 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d10) & month(as.Date(rawSTR.5$RCTDATE)) == month(d10) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d10) & month(as.Date(rawSTR.5$RCTDATE)) == month(d10) )])*100, digits = 1)
STR.5.M11 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d11) & month(as.Date(rawSTR.5$RCTDATE)) == month(d11) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d11) & month(as.Date(rawSTR.5$RCTDATE)) == month(d11) )])*100, digits = 1)
STR.5.M12 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d12) & month(as.Date(rawSTR.5$RCTDATE)) == month(d12) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d12) & month(as.Date(rawSTR.5$RCTDATE)) == month(d12) )])*100, digits = 1)
STR.5.M13 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d13) & month(as.Date(rawSTR.5$RCTDATE)) == month(d13) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d13) & month(as.Date(rawSTR.5$RCTDATE)) == month(d13) )])*100, digits = 1)
STR.5.M14 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d14) & month(as.Date(rawSTR.5$RCTDATE)) == month(d14) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d14) & month(as.Date(rawSTR.5$RCTDATE)) == month(d14) )])*100, digits = 1)
STR.5.M15 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d15) & month(as.Date(rawSTR.5$RCTDATE)) == month(d15) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d15) & month(as.Date(rawSTR.5$RCTDATE)) == month(d15) )])*100, digits = 1)
STR.5.M16 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d16) & month(as.Date(rawSTR.5$RCTDATE)) == month(d16) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d16) & month(as.Date(rawSTR.5$RCTDATE)) == month(d16) )])*100, digits = 1)
STR.5.M17 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d17) & month(as.Date(rawSTR.5$RCTDATE)) == month(d17) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d17) & month(as.Date(rawSTR.5$RCTDATE)) == month(d17) )])*100, digits = 1)
STR.5.M18 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d18) & month(as.Date(rawSTR.5$RCTDATE)) == month(d18) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d18) & month(as.Date(rawSTR.5$RCTDATE)) == month(d18) )])*100, digits = 1)
STR.5.M19 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d19) & month(as.Date(rawSTR.5$RCTDATE)) == month(d19) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d19) & month(as.Date(rawSTR.5$RCTDATE)) == month(d19) )])*100, digits = 1)
STR.5.M20 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d20) & month(as.Date(rawSTR.5$RCTDATE)) == month(d20) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d20) & month(as.Date(rawSTR.5$RCTDATE)) == month(d20) )])*100, digits = 1)
STR.5.M21 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d21) & month(as.Date(rawSTR.5$RCTDATE)) == month(d21) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d21) & month(as.Date(rawSTR.5$RCTDATE)) == month(d21) )])*100, digits = 1)
STR.5.M22 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d22) & month(as.Date(rawSTR.5$RCTDATE)) == month(d22) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d22) & month(as.Date(rawSTR.5$RCTDATE)) == month(d22) )])*100, digits = 1)
STR.5.M23 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d23) & month(as.Date(rawSTR.5$RCTDATE)) == month(d23) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d23) & month(as.Date(rawSTR.5$RCTDATE)) == month(d23) )])*100, digits = 1)
STR.5.M24 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d24) & month(as.Date(rawSTR.5$RCTDATE)) == month(d24) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d24) & month(as.Date(rawSTR.5$RCTDATE)) == month(d24) )])*100, digits = 1)
STR.5.M25 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d25) & month(as.Date(rawSTR.5$RCTDATE)) == month(d25) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d25) & month(as.Date(rawSTR.5$RCTDATE)) == month(d25) )])*100, digits = 1)
STR.5.M26 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d26) & month(as.Date(rawSTR.5$RCTDATE)) == month(d26) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d26) & month(as.Date(rawSTR.5$RCTDATE)) == month(d26) )])*100, digits = 1)
STR.5.M27 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d27) & month(as.Date(rawSTR.5$RCTDATE)) == month(d27) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d27) & month(as.Date(rawSTR.5$RCTDATE)) == month(d27) )])*100, digits = 1)
STR.5.M28 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d28) & month(as.Date(rawSTR.5$RCTDATE)) == month(d28) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d28) & month(as.Date(rawSTR.5$RCTDATE)) == month(d28) )])*100, digits = 1)
STR.5.M29 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d29) & month(as.Date(rawSTR.5$RCTDATE)) == month(d29) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d29) & month(as.Date(rawSTR.5$RCTDATE)) == month(d29) )])*100, digits = 1)
STR.5.M30 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d30) & month(as.Date(rawSTR.5$RCTDATE)) == month(d30) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d30) & month(as.Date(rawSTR.5$RCTDATE)) == month(d30) )])*100, digits = 1)
STR.5.M31 <- round(sum(rawSTR.5$numerator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d31) & month(as.Date(rawSTR.5$RCTDATE)) == month(d31) )])/sum(rawSTR.5$denominator_value[which(year(as.Date(rawSTR.5$RCTDATE)) == year(d31) & month(as.Date(rawSTR.5$RCTDATE)) == month(d31) )])*100, digits = 1)
STR.5 <- data.frame("Cabinet" = "Streets",
"Metric" = "Code Enforcement On-Time %",
"July_2016" = STR.5.M1,
"August" = STR.5.M2,
"September" = STR.5.M3,
"October" = STR.5.M4,
"November" = STR.5.M5,
"December" = STR.5.M6,
"January_2017" = STR.5.M7,
"February" = STR.5.M8,
"March" = STR.5.M9,
"April" = STR.5.M10,
"May" = STR.5.M11,
"June" = STR.5.M12,
"July_2017" = STR.5.M13,
"August" = STR.5.M14,
"September" = STR.5.M15,
"October" = STR.5.M16,
"November" = STR.5.M17,
"December" = STR.5.M18,
"January_2018" = STR.5.M19,
"February" = STR.5.M20,
"March" = STR.5.M21,
"April" = STR.5.M22,
"May" = STR.5.M23,
"June" = STR.5.M24,
"July_2018" = STR.5.M25,
"August" = STR.5.M26,
"September" = STR.5.M27,
"October" = STR.5.M28,
"November" = STR.5.M29,
"December" = STR.5.M30,
"January_2019" = STR.5.M31
)
hansdb <- dbConnect(odbc::odbc(), .connection_string = 'driver={SQL Server};server=ZPSQLTMP1;database=HansenProd;trusted_connection=true')
rawSTR.6 <- dbGetQuery(hansdb, {"SELECT
'Code Enforcement Tickets Issued Daily' AS Metric,
CAST(CASEDTTM AS DATE) AS date,
COUNT(CASE WHEN [FEEDESC] != 'Processing Fee' THEN 1 END) AS NUM_VIO
FROM [HansenProd].[dbo].[vw_CEPTicketsWithViolationAndFeesSingleParcel]
GROUP BY CAST(CASEDTTM AS DATE)
ORDER BY CAST(CASEDTTM AS DATE) DESC
"})
closeAllConnections()
rawSTR.6 <- rawSTR.6[-which(is.na(rawSTR.6$date)),]
STR.6.M1 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d1) & month(as.Date(rawSTR.6$date)) == month(d1) )]), digits = 1)
STR.6.M2 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d2) & month(as.Date(rawSTR.6$date)) == month(d2) )]), digits = 1)
STR.6.M3 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d3) & month(as.Date(rawSTR.6$date)) == month(d3) )]), digits = 1)
STR.6.M4 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d4) & month(as.Date(rawSTR.6$date)) == month(d4) )]), digits = 1)
STR.6.M5 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d5) & month(as.Date(rawSTR.6$date)) == month(d5) )]), digits = 1)
STR.6.M6 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d6) & month(as.Date(rawSTR.6$date)) == month(d6) )]), digits = 1)
STR.6.M7 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d7) & month(as.Date(rawSTR.6$date)) == month(d7) )]), digits = 1)
STR.6.M8 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d8) & month(as.Date(rawSTR.6$date)) == month(d8) )]), digits = 1)
STR.6.M9 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d9) & month(as.Date(rawSTR.6$date)) == month(d9) )]), digits = 1)
STR.6.M10 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d10) & month(as.Date(rawSTR.6$date)) == month(d10) )]), digits = 1)
STR.6.M11 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d11) & month(as.Date(rawSTR.6$date)) == month(d11) )]), digits = 1)
STR.6.M12 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d12) & month(as.Date(rawSTR.6$date)) == month(d12) )]), digits = 1)
STR.6.M13 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d13) & month(as.Date(rawSTR.6$date)) == month(d13) )]), digits = 1)
STR.6.M14 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d14) & month(as.Date(rawSTR.6$date)) == month(d14) )]), digits = 1)
STR.6.M15 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d15) & month(as.Date(rawSTR.6$date)) == month(d15) )]), digits = 1)
STR.6.M16 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d16) & month(as.Date(rawSTR.6$date)) == month(d16) )]), digits = 1)
STR.6.M17 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d17) & month(as.Date(rawSTR.6$date)) == month(d17) )]), digits = 1)
STR.6.M18 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d18) & month(as.Date(rawSTR.6$date)) == month(d18) )]), digits = 1)
STR.6.M19 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d19) & month(as.Date(rawSTR.6$date)) == month(d19) )]), digits = 1)
STR.6.M20 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d20) & month(as.Date(rawSTR.6$date)) == month(d20) )]), digits = 1)
STR.6.M21 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d21) & month(as.Date(rawSTR.6$date)) == month(d21) )]), digits = 1)
STR.6.M22 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d22) & month(as.Date(rawSTR.6$date)) == month(d22) )]), digits = 1)
STR.6.M23 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d23) & month(as.Date(rawSTR.6$date)) == month(d23) )]), digits = 1)
STR.6.M24 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d24) & month(as.Date(rawSTR.6$date)) == month(d24) )]), digits = 1)
STR.6.M25 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d25) & month(as.Date(rawSTR.6$date)) == month(d25) )]), digits = 1)
STR.6.M26 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d26) & month(as.Date(rawSTR.6$date)) == month(d26) )]), digits = 1)
STR.6.M27 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d27) & month(as.Date(rawSTR.6$date)) == month(d27) )]), digits = 1)
STR.6.M28 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d28) & month(as.Date(rawSTR.6$date)) == month(d28) )]), digits = 1)
STR.6.M29 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d29) & month(as.Date(rawSTR.6$date)) == month(d29) )]), digits = 1)
STR.6.M30 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d30) & month(as.Date(rawSTR.6$date)) == month(d30) )]), digits = 1)
STR.6.M31 <- round(sum(rawSTR.6$NUM_VIO[which(year(as.Date(rawSTR.6$date)) == year(d31) & month(as.Date(rawSTR.6$date)) == month(d31) )]), digits = 1)
STR.6 <- data.frame("Cabinet" = "Streets",
"Metric" = "Numer of Violations Issued Monthly",
"July_2016" = STR.6.M1,
"August" = STR.6.M2,
"September" = STR.6.M3,
"October" = STR.6.M4,
"November" = STR.6.M5,
"December" = STR.6.M6,
"January_2017" = STR.6.M7,
"February" = STR.6.M8,
"March" = STR.6.M9,
"April" = STR.6.M10,
"May" = STR.6.M11,
"June" = STR.6.M12,
"July_2017" = STR.6.M13,
"August" = STR.6.M14,
"September" = STR.6.M15,
"October" = STR.6.M16,
"November" = STR.6.M17,
"December" = STR.6.M18,
"January_2018" = STR.6.M19,
"February" = STR.6.M20,
"March" = STR.6.M21,
"April" = STR.6.M22,
"May" = STR.6.M23,
"June" = STR.6.M24,
"July_2018" = STR.6.M25,
"August" = STR.6.M26,
"September" = STR.6.M27,
"October" = STR.6.M28,
"November" = STR.6.M29,
"December" = STR.6.M30,
"January_2019" = STR.6.M31
)
LAGANdb <- dbConnect(odbc::odbc(), .connection_string = "driver={SQL Server};server=zpcrmbi01;database=LaganPDM;uid=Tableau_prod_readusr; pwd=Tableau_prod_readusr@2015")
rawSTR.10 <- dbGetQuery(LAGANdb, {"SELECT
'MISSED TRASH ON-TIME %' as metric_name,
CONVERT(DATE,[CLOSED_DT]) AS date,
COUNT(DISTINCT
CASE WHEN [CLOSED_DT] <= [SLA_TARGET_DT]
THEN [CASE_ENQUIRY_ID]
ELSE NULL
END
) as numerator_value,
COUNT(DISTINCT [CASE_ENQUIRY_ID]) as denominator_value
FROM [LaganPDM].[dbo].[lgnbo_CASE_ENQUIRY_B00_DENYHS]
WHERE [CASE_STATUS] = 'Closed'
AND [QUEUE] LIKE '%PWDx_Missed Trash%'
AND [SLA_TARGET_DT] IS NOT NULL
AND [SOURCE] NOT IN ('City Worker App','Employee Generated')
AND CONVERT(DATE,[CLOSED_DT]) < CONVERT(DATE,GETDATE())
GROUP BY CONVERT(DATE,[CLOSED_DT])
ORDER BY CONVERT(DATE,[CLOSED_DT]) DESC
"})
closeAllConnections()
if (nrow(rawSTR.10[-which(is.na(rawSTR.10$date)),]) > 0){
rawSTR.10 <- rawSTR.10[-which(is.na(rawSTR.10$date)),]
}
STR.10.M1 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d1) & month(as.Date(rawSTR.10$date)) == month(d1) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d1) & month(as.Date(rawSTR.10$date)) == month(d1) )])*100, digits = 1)
STR.10.M2 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d2) & month(as.Date(rawSTR.10$date)) == month(d2) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d2) & month(as.Date(rawSTR.10$date)) == month(d2) )])*100, digits = 1)
STR.10.M3 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d3) & month(as.Date(rawSTR.10$date)) == month(d3) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d3) & month(as.Date(rawSTR.10$date)) == month(d3) )])*100, digits = 1)
STR.10.M4 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d4) & month(as.Date(rawSTR.10$date)) == month(d4) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d4) & month(as.Date(rawSTR.10$date)) == month(d4) )])*100, digits = 1)
STR.10.M5 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d5) & month(as.Date(rawSTR.10$date)) == month(d5) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d5) & month(as.Date(rawSTR.10$date)) == month(d5) )])*100, digits = 1)
STR.10.M6 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d6) & month(as.Date(rawSTR.10$date)) == month(d6) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d6) & month(as.Date(rawSTR.10$date)) == month(d6) )])*100, digits = 1)
STR.10.M7 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d7) & month(as.Date(rawSTR.10$date)) == month(d7) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d7) & month(as.Date(rawSTR.10$date)) == month(d7) )])*100, digits = 1)
STR.10.M8 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d8) & month(as.Date(rawSTR.10$date)) == month(d8) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d8) & month(as.Date(rawSTR.10$date)) == month(d8) )])*100, digits = 1)
STR.10.M9 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d9) & month(as.Date(rawSTR.10$date)) == month(d9) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d9) & month(as.Date(rawSTR.10$date)) == month(d9) )])*100, digits = 1)
STR.10.M10 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d10) & month(as.Date(rawSTR.10$date)) == month(d10) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d10) & month(as.Date(rawSTR.10$date)) == month(d10) )])*100, digits = 1)
STR.10.M11 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d11) & month(as.Date(rawSTR.10$date)) == month(d11) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d11) & month(as.Date(rawSTR.10$date)) == month(d11) )])*100, digits = 1)
STR.10.M12 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d12) & month(as.Date(rawSTR.10$date)) == month(d12) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d12) & month(as.Date(rawSTR.10$date)) == month(d12) )])*100, digits = 1)
STR.10.M13 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d13) & month(as.Date(rawSTR.10$date)) == month(d13) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d13) & month(as.Date(rawSTR.10$date)) == month(d13) )])*100, digits = 1)
STR.10.M14 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d14) & month(as.Date(rawSTR.10$date)) == month(d14) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d14) & month(as.Date(rawSTR.10$date)) == month(d14) )])*100, digits = 1)
STR.10.M15 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d15) & month(as.Date(rawSTR.10$date)) == month(d15) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d15) & month(as.Date(rawSTR.10$date)) == month(d15) )])*100, digits = 1)
STR.10.M16 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d16) & month(as.Date(rawSTR.10$date)) == month(d16) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d16) & month(as.Date(rawSTR.10$date)) == month(d16) )])*100, digits = 1)
STR.10.M17 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d17) & month(as.Date(rawSTR.10$date)) == month(d17) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d17) & month(as.Date(rawSTR.10$date)) == month(d17) )])*100, digits = 1)
STR.10.M18 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d18) & month(as.Date(rawSTR.10$date)) == month(d18) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d18) & month(as.Date(rawSTR.10$date)) == month(d18) )])*100, digits = 1)
STR.10.M19 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d19) & month(as.Date(rawSTR.10$date)) == month(d19) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d19) & month(as.Date(rawSTR.10$date)) == month(d19) )])*100, digits = 1)
STR.10.M20 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d20) & month(as.Date(rawSTR.10$date)) == month(d20) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d20) & month(as.Date(rawSTR.10$date)) == month(d20) )])*100, digits = 1)
STR.10.M21 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d21) & month(as.Date(rawSTR.10$date)) == month(d21) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d21) & month(as.Date(rawSTR.10$date)) == month(d21) )])*100, digits = 1)
STR.10.M22 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d22) & month(as.Date(rawSTR.10$date)) == month(d22) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d22) & month(as.Date(rawSTR.10$date)) == month(d22) )])*100, digits = 1)
STR.10.M23 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d23) & month(as.Date(rawSTR.10$date)) == month(d23) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d23) & month(as.Date(rawSTR.10$date)) == month(d23) )])*100, digits = 1)
STR.10.M24 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d24) & month(as.Date(rawSTR.10$date)) == month(d24) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d24) & month(as.Date(rawSTR.10$date)) == month(d24) )])*100, digits = 1)
STR.10.M25 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d25) & month(as.Date(rawSTR.10$date)) == month(d25) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d25) & month(as.Date(rawSTR.10$date)) == month(d25) )])*100, digits = 1)
STR.10.M26 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d26) & month(as.Date(rawSTR.10$date)) == month(d26) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d26) & month(as.Date(rawSTR.10$date)) == month(d26) )])*100, digits = 1)
STR.10.M27 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d27) & month(as.Date(rawSTR.10$date)) == month(d27) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d27) & month(as.Date(rawSTR.10$date)) == month(d27) )])*100, digits = 1)
STR.10.M28 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d28) & month(as.Date(rawSTR.10$date)) == month(d28) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d28) & month(as.Date(rawSTR.10$date)) == month(d28) )])*100, digits = 1)
STR.10.M29 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d29) & month(as.Date(rawSTR.10$date)) == month(d29) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d29) & month(as.Date(rawSTR.10$date)) == month(d29) )])*100, digits = 1)
STR.10.M30 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d30) & month(as.Date(rawSTR.10$date)) == month(d30) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d30) & month(as.Date(rawSTR.10$date)) == month(d30) )])*100, digits = 1)
STR.10.M31 <- round(sum(rawSTR.10$numerator_value[which(year(as.Date(rawSTR.10$date)) == year(d31) & month(as.Date(rawSTR.10$date)) == month(d31) )])/sum(rawSTR.10$denominator_value[which(year(as.Date(rawSTR.10$date)) == year(d31) & month(as.Date(rawSTR.10$date)) == month(d31) )])*100, digits = 1)
STR.10 <- data.frame("Cabinet" = "Streets",
"Metric" = "% Missed Trash Cases Responded to On Time",
"July_2016" = STR.10.M1,
"August" = STR.10.M2,
"September" = STR.10.M3,
"October" = STR.10.M4,
"November" = STR.10.M5,
"December" = STR.10.M6,
"January_2017" = STR.10.M7,
"February" = STR.10.M8,
"March" = STR.10.M9,
"April" = STR.10.M10,
"May" = STR.10.M11,
"June" = STR.10.M12,
"July_2017" = STR.10.M13,
"August" = STR.10.M14,
"September" = STR.10.M15,
"October" = STR.10.M16,
"November" = STR.10.M17,
"December" = STR.10.M18,
"January_2018" = STR.10.M19,
"February" = STR.10.M20,
"March" = STR.10.M21,
"April" = STR.10.M22,
"May" = STR.10.M23,
"June" = STR.10.M24,
"July_2018" = STR.10.M25,
"August" = STR.10.M26,
"September" = STR.10.M27,
"October" = STR.10.M28,
"November" = STR.10.M29,
"December" = STR.10.M30,
"January_2019" = STR.10.M31
)
LAGANdb <- dbConnect(odbc::odbc(), .connection_string = "driver={SQL Server};server=zpcrmbi01;database=LaganPDM;uid=Tableau_prod_readusr; pwd=Tableau_prod_readusr@2015")
rawSTR.11 <- dbGetQuery(LAGANdb, {" SELECT
'Overdue Street Light Outage Requests' as metric_name,
CONVERT(DATE,[OPEN_DT]) AS open_date,
COUNT(DISTINCT
CASE WHEN CONVERT(DATE,[SLA_TARGET_DT]) < CONVERT(DATE,GETDATE())
THEN [CASE_ENQUIRY_ID]
ELSE NULL
END
) as open_cases,
COUNT(DISTINCT [CASE_ENQUIRY_ID]) as all_cases
FROM [LaganPDM].[dbo].[lgnbo_CASE_ENQUIRY_B00_DENYHS]
WHERE [QUEUE] LIKE '%PWDx_Street Light Outages%'
AND [CASE_STATUS] = 'Open'
AND [SLA_TARGET_DT] IS NOT NULL
AND [SOURCE] NOT IN ('City Worker App','Employee Generated')
GROUP BY CONVERT(DATE,[OPEN_DT])
ORDER BY CONVERT(DATE,[OPEN_DT]) DESC
"})
closeAllConnections()
if (nrow(rawSTR.11[-which(is.na(rawSTR.11$open_date)),]) > 0){
rawSTR.11 <- rawSTR.11[-which(is.na(rawSTR.11$open_date)),]
}
STR.11.M1 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d1) & month(as.Date(rawSTR.11$open_date)) == month(d1) )])
STR.11.M2 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d2) & month(as.Date(rawSTR.11$open_date)) == month(d2) )])
STR.11.M3 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d3) & month(as.Date(rawSTR.11$open_date)) == month(d3) )])
STR.11.M4 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d4) & month(as.Date(rawSTR.11$open_date)) == month(d4) )])
STR.11.M5 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d5) & month(as.Date(rawSTR.11$open_date)) == month(d5) )])
STR.11.M6 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d6) & month(as.Date(rawSTR.11$open_date)) == month(d6) )])
STR.11.M7 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d7) & month(as.Date(rawSTR.11$open_date)) == month(d7) )])
STR.11.M8 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d8) & month(as.Date(rawSTR.11$open_date)) == month(d8) )])
STR.11.M9 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d9) & month(as.Date(rawSTR.11$open_date)) == month(d9) )])
STR.11.M10 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d10) & month(as.Date(rawSTR.11$open_date)) == month(d10) )])
STR.11.M11 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d11) & month(as.Date(rawSTR.11$open_date)) == month(d11) )])
STR.11.M12 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d12) & month(as.Date(rawSTR.11$open_date)) == month(d12) )])
STR.11.M13 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d13) & month(as.Date(rawSTR.11$open_date)) == month(d13) )])
STR.11.M14 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d14) & month(as.Date(rawSTR.11$open_date)) == month(d14) )])
STR.11.M15 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d15) & month(as.Date(rawSTR.11$open_date)) == month(d15) )])
STR.11.M16 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d16) & month(as.Date(rawSTR.11$open_date)) == month(d16) )])
STR.11.M17 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d17) & month(as.Date(rawSTR.11$open_date)) == month(d17) )])
STR.11.M18 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d18) & month(as.Date(rawSTR.11$open_date)) == month(d18) )])
STR.11.M19 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d19) & month(as.Date(rawSTR.11$open_date)) == month(d19) )])
STR.11.M20 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d20) & month(as.Date(rawSTR.11$open_date)) == month(d20) )])
STR.11.M21 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d21) & month(as.Date(rawSTR.11$open_date)) == month(d21) )])
STR.11.M22 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d22) & month(as.Date(rawSTR.11$open_date)) == month(d22) )])
STR.11.M23 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d23) & month(as.Date(rawSTR.11$open_date)) == month(d23) )])
STR.11.M24 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d24) & month(as.Date(rawSTR.11$open_date)) == month(d24) )])
STR.11.M25 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d25) & month(as.Date(rawSTR.11$open_date)) == month(d25) )])
STR.11.M26 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d26) & month(as.Date(rawSTR.11$open_date)) == month(d26) )])
STR.11.M27 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d27) & month(as.Date(rawSTR.11$open_date)) == month(d27) )])
STR.11.M28 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d28) & month(as.Date(rawSTR.11$open_date)) == month(d28) )])
STR.11.M29 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d29) & month(as.Date(rawSTR.11$open_date)) == month(d29) )])
STR.11.M30 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d30) & month(as.Date(rawSTR.11$open_date)) == month(d30) )])
STR.11.M31 <- sum(rawSTR.11$open_cases[which(year(as.Date(rawSTR.11$open_date)) == year(d31) & month(as.Date(rawSTR.11$open_date)) == month(d31) )])
STR.11 <- data.frame("Cabinet" = "Streets",
"Metric" = "Monthly Overdue Street Light Outage Requests",
"July_2016" = STR.11.M1,
"August" = STR.11.M2,
"September" = STR.11.M3,
"October" = STR.11.M4,
"November" = STR.11.M5,
"December" = STR.11.M6,
"January_2017" = STR.11.M7,
"February" = STR.11.M8,
"March" = STR.11.M9,
"April" = STR.11.M10,
"May" = STR.11.M11,
"June" = STR.11.M12,
"July_2017" = STR.11.M13,
"August" = STR.11.M14,
"September" = STR.11.M15,
"October" = STR.11.M16,
"November" = STR.11.M17,
"December" = STR.11.M18,
"January_2018" = STR.11.M19,
"February" = STR.11.M20,
"March" = STR.11.M21,
"April" = STR.11.M22,
"May" = STR.11.M23,
"June" = STR.11.M24,
"July_2018" = STR.11.M25,
"August" = STR.11.M26,
"September" = STR.11.M27,
"October" = STR.11.M28,
"November" = STR.11.M29,
"December" = STR.11.M30,
"January_2019" = STR.11.M31
)
STR.DPW <- rbind(STR.1,
STR.2,
STR.5,
STR.6,
STR.10,
STR.11)
STR.DPW[,2:7] <- round(STR.DPW[,2:7], digits = 1)
st.to <- Sys.time()
STR.DPW
KPI <- rbind(AF,
AC,
BFD,
BPD,
BPS,
CE,
ED,
EV,
HHS.BPHC,
HOU,
IT,
OP,
STR
)
STR <- rbind(STR.1,
STR.2,
STR.5,
STR.6,
STR.10,
STR.11
)
STR[,2:7] <- round(STR[,2:7], digits = 1)
KPI <- rbind(AF,
AC,
BFD,
BPD,
BPS,
CE,
ED,
EV,
HHS.BPHC,
HOU,
IT,
OP,
STR
)
KPI
colnames(KPI) <- c("Cabinet",
"Metric",
"July 2016",
"August 2016",
"September 2016",
"October 2016",
"November 2016",
"December 2016",
"January 2017",
"February 2017",
"March 2017",
"April 2017",
"May 2017",
"June 2017",
"July 2017",
"August 2017",
"September 2017",
"October 2017",
"November 2017",
"December 2017",
"January 2018",
"February 2018",
"March 2018",
"April 2018",
"May 2018",
"June 2018",
"July 2018",
"August 2018",
"September 2018",
"October 2018",
"November 2018",
"December 2018",
"January 2019")
KPI
write.csv(KPI, "H:/My Documents/Git Code Examples/KPI_Dashboard/KPI Flat File/KPI_Flat.csv", rrow.names = FALSE)
write.csv(KPI, "H:/My Documents/Git Code Examples/KPI_Dashboard/KPI Flat File/KPI_Flat.csv", row.names = FALSE)
